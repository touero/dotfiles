#!/bin/bash
# @author touero
# @since 2025
# dm: Unexplained dmenu app launcher?

[[ -f "$HOME/.xprofile" ]] && source "$HOME/.xprofile"

DMENU=(dmenu -i -l 3 -fn "Ubuntu Mono-24" -p "Command:")
CHOICE=$(echo -e "bm\npw\nocr\ncud\n" | "${DMENU[@]}")

BOOKMARK_FILE="$HOME/.config/bookmarks"

expand_env() {
  local val="$1"
  if [[ "$val" =~ ^\$[A-Za-z_][A-Za-z0-9_]*$ ]]; then
    val=$(eval echo "$val")
  fi
  echo "$val"
}

copy_clipboard() {
  if command -v xclip &>/dev/null; then
    xclip -selection clipboard
  elif command -v wl-copy &>/dev/null; then
    wl-copy
  fi
}

case "$CHOICE" in
bm)
  [[ -f "$BOOKMARK_FILE" ]] || {
    echo "No bookmarks found"
    exit 1
  }

  sleep 0.1
  KEY=$(cut -d'|' -f1 "$BOOKMARK_FILE" | "${DMENU[@]}")
  [[ -z "$KEY" ]] && exit 0
  VALUE=$(grep "^$KEY" "$BOOKMARK_FILE" | cut -d'|' -f2- | sed 's/^ *//;s/ *$//')
  echo "$VALUE" | tee >(copy_clipboard)
  ;;
pw)
  echo $DOCKER_PWD | tee >(copy_clipboard)
  ;;
ocr)
  $HOME/.local/bin/ocr
  ;;
cud)
  echo $(date '+%Y_%m_%d_%H') | tee >(copy_clipboard)
  ;;
*)
  exit 0
  ;;
esac
