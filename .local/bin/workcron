#!/usr/bin/env bash
# workcron: a cron job, startup or kill some processes in get off/on work
# @author touero
# @since 2025

wait_for_swaylock() {
  while pgrep -x swaylock >/dev/null; do
    sleep 1
  done
}

off_work() {
  for app in "$@"; do
    echo "$app"
    pkill -9 -f "/$app"
  done
}

on_work() {
  for app in "$@"; do
    if pgrep -f "^${app}(\$| )" >/dev/null; then
      echo "$app already running"
      continue
    fi

    wait_for_swaylock
    "$app" &

    if [[ "$app" == *feishu* ]]; then
      for _ in {1..30}; do
        swaymsg '[class="Bytedance-feishu"] move to workspace number 3' && break
        sleep 0.2
      done
    fi
  done
}

case "$1" in
on)
  shift
  on_work "$@"
  ;;
off)
  shift
  off_work "$@"
  ;;
*)
  echo "not supprt args"
  ;;
esac
