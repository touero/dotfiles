#!/usr/bin/env bash
# @author touero
# @since 2025
# wttr: check current localtion weather in cache

if [ "$1" = "cat" ]; then
  WEATHER=$(cat $HOME/.cache/wttr)
else
  if [ $# -eq 0 ]; then
    # Uncomment not in mainland China:
    # LOCATION=$(curl -s "https://api.myip.la/en?json" | jq -r '.location.city')
    # CITY=$(echo "$LOCATION" | sed 's/ /%20/g')
    LOCATION=$(curl -s "http://myip.ipip.net")
    CITY=$(echo "$LOCATION" | awk '{print $5}')
    WEATHER=$(curl -s "wttr.in/$CITY?format=%c+%t+%m+%w+%p+%P+%D+%S")
  else
    WEATHER=$(curl -s "wttr.in/$1?format=%c+%t+%w+%p+%P+%D+%S")
  fi
fi

notify-send "$WEATHER"
replace_space() {
  WEATHER=$(echo "$WEATHER" | sed 's/  */ /g')
}
