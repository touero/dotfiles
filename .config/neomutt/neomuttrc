# $XDF_CONFIG_HOME/neomutt/neomuttrc
# @author touero(fix from nate zhou)
# @since 2025


set editor = "nvim"
set move = no
unset mark_old

# GPG encryption and signature
set crypt_use_gpgme=yes
set postpone_encrypt = yes
set pgp_self_encrypt = yes
set crypt_use_pka = no
set crypt_autosign = no
set crypt_autoencrypt = no
set crypt_autopgp = yes

## group conversation
set sort=threads
set sort=reverse-date
set sort_aux=last-date-received

## sidebar
set sidebar_width=18
set sidebar_visible
set sidebar_short_path
set sidebar_folder_indent
set sidebar_format = "%B %* [%?N?%N/?%S]"
set mail_check_stats

## keybindings
# ^G is hardcoded as `abort` and cannot be remaped
bind pager,browser,attach,alias       h       exit
bind pager                            l       view-attachments
bind pager                            k       previous-line
bind pager                            j       next-line
bind pager                            g       top
bind pager                            G       bottom
bind index                            j       next-entry
bind index                            k       previous-entry
bind attach,index                     g       first-entry
bind attach,index                     G       last-entry
bind index                            l       display-message
bind attach                           l       view-attach
bind browser,alias                    l       select-entry
bind index                            /       search
bind index                            ?       limit
bind index,pager,attach               <F1>    help
bind pager                            H       display-toggle-weed
bind attach,index,pager               \CD     next-page
bind attach,index,pager               \CU     previous-page

### sidebar
bind index,pager K sidebar-prev
bind index,pager J sidebar-next
bind index,pager L sidebar-open
bind index,pager \CB sidebar-toggle-visible

source "~/.config/neomutt/colorsrc"

source "~/.config/neomutt/accounts/account1.rc"

folder-hook 'account1' 'source ~/.config/neomutt/account1.rc'
folder-hook 'account2' 'source ~/.config/neomutt/account2.rc'
folder-hook 'account3' 'source ~/.config/neomutt/account3.rc'
folder-hook 'account4' 'source ~/.config/neomutt/account4.rc'
folder-hook 'account5' 'source ~/.config/neomutt/account5.rc'

## switch accounts (,+1)
macro index ,1 "<enter-command>unmailboxes *<enter><enter-command>source ~/.config/neomutt/accounts/account1.rc<enter><sync-mailbox><change-folder>!<enter>"
macro index ,2 "<enter-command>unmailboxes *<enter><enter-command>source ~/.config/neomutt/accounts/account2.rc<enter><sync-mailbox><change-folder>!<enter>"
macro index ,3 "<enter-command>unmailboxes *<enter><enter-command>source ~/.config/neomutt/accounts/account3.rc<enter><sync-mailbox><change-folder>!<enter>"
macro index ,4 "<enter-command>unmailboxes *<enter><enter-command>source ~/.config/neomutt/accounts/account4.rc<enter><sync-mailbox><change-folder>!<enter>"
macro index ,5 "<enter-command>unmailboxes *<enter><enter-command>source ~/.config/neomutt/accounts/account5.rc<enter><sync-mailbox><change-folder>!<enter>"

macro attach .j "|awk '{match(\$0,/json:{.*}/); if(RSTART>0){print substr(\$0,1,RSTART-1); print substr(\$0,RSTART+5,RLENGTH-5) | \"jq . | tee /tmp/json\"; print substr(\$0,RSTART+RLENGTH)} else {print}}'<Enter>" "Format JSON"

